<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Heurigenkalender Stammersdorf – Öffnungszeiten & Standorte | AusCheckt is</title>
    <meta name="description" content="Der aktuelle Heurigenkalender für Stammersdorf: Alle Öffnungszeiten, Standorte und Termine der schönsten Heurigen auf einen Blick.">

    <link rel="icon" href="favicon.ico">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=UnifrakturCook:wght@700&display=swap" rel="stylesheet">

    <!-- Bootstrap CSS -->
    <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
        rel="stylesheet" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="custom.css">
</head>
    </head>
    <body>

        <div id="main">
        <div class="container text-center">
            <h1 class="mb-4 text-primary">AusCheckt is</h1>
        </div>
        
        <div class="container text-center mb-4">
            <!-- damit auscheckt is, wann ausgsteckt is. -->
            <p>Der Heurigenkalender zeigt Öffnungszeiten und Standorte der schönsten Heurigen <strong>Stammersdorfs</strong>. Die Daten stammen von den einzelnen Webseiten der Heruigen und vom <a href="http://weinort-stammersdorf.at/weinbau/wp-content/uploads/2021/03/Heurigenkalender-2025_v3-druck.pdf" target="_blank">offiziellen Kalender</a>.</p> 
        </div>

        
        <div id="open-today" class="container text-center mb-4">
            <h2><span id="current-date"></span></h2>
            <div class="mb-2">
    <button id="prev-day" class="btn btn-primary btn-lg rounded-circle me-2 d-inline-flex align-items-center justify-content-center" style="width:2.5em; height:2.5em;" disabled title="Vortag">
        <span class="visually-hidden">Vortag</span>
        <svg xmlns="http://www.w3.org/2000/svg" width="1.5em" height="1.5em" fill="currentColor" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"/>
        </svg>
    </button>
    <button id="next-day" class="btn btn-primary btn-lg rounded-circle d-inline-flex align-items-center justify-content-center" style="width:2.5em; height:2.5em;" title="Nächster Tag">
        <span class="visually-hidden">Nächster Tag</span>
        <svg xmlns="http://www.w3.org/2000/svg" width="1.5em" height="1.5em" fill="currentColor" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M4.646 14.354a.5.5 0 0 1 0-.708L10.293 8 4.646 2.354a.5.5 0 1 1 .708-.708l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708 0z"/>
        </svg>
    </button>
</div>
            <div id="map" style="height: 320px; width: 100%; margin-bottom: 1em;"></div>
            <ul id="open-today-list" class="list-unstyled"></ul>
        </div>

        </div>

        <footer class="text-center mt-5 py-4 border-top">
            <p>
    <small>Open-Source Projekt für Heurigen aficionados:  <img src="assets/github-mark.svg" alt="GitHub" style="height: 1em; vertical-align: middle; margin-right: 0.3em;"> <a href="https://github.com/sektionschef/auschecktis">GitHub Repo</a></small></p>
</footer>


<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

        <script>
const jsonFiles = [
    'data/ausblick_wien.json',
    'data/almdudler_standl.json',
    'data/barthuette.json',
    'data/biohof_nummer_5.json',
    'data/goebel.json',
    'data/presshaus.json',
    'data/wieninger.json',
    'data/lentner_koarl.json',
    'data/leopold.json',
    'data/helm.json',
    'data/reinbacher.json',
    'data/klager.json',
    'data/dornroeschenkeller.json',
    'data/duschl.json',
    'data/gustl.json',
    'data/kammerer.json',
    'data/weinhandwerk.json',
    'data/walter.json',
    'data/ausblick_wien.json',
    'data/christl.json'
];


const today = new Date();
const maxDate = new Date(today);
maxDate.setDate(today.getDate() + 7);

let currentDate = new Date(today);

const ul = document.getElementById('open-today-list');
const currentDateSpan = document.getElementById('current-date');
const prevBtn = document.getElementById('prev-day');
const nextBtn = document.getElementById('next-day');

function formatDate(date) {
    return date.toLocaleDateString('de-AT', { weekday: 'long', year: 'numeric', month: '2-digit', day: '2-digit' });
}

function getISO(date) {
    return date.toISOString().slice(0, 10);
}

let allEvents = [];

function renderList() {
    const currentISO = getISO(currentDate);
    const todayISO = getISO(today);
    const tomorrow = new Date(today);
    tomorrow.setDate(today.getDate() + 1);
    const tomorrowISO = getISO(tomorrow);

    // Set heading text
    if (currentISO === todayISO) {
        currentDateSpan.textContent = "Heute geöffnet";
    } else if (currentISO === tomorrowISO) {
        currentDateSpan.textContent = "Morgen geöffnet";
    } else {
        currentDateSpan.textContent = "Geöffnet am " + formatDate(currentDate);
    }

    // Enable/disable prev/next buttons
    prevBtn.disabled = currentISO <= todayISO;
    nextBtn.disabled = currentISO >= getISO(maxDate);

    // Filter for current date
    const openToday = allEvents.filter(event => event.start.slice(0, 10) === currentISO);

    ul.innerHTML = '';
    clearMarkers();

    if (openToday.length === 0) {
        ul.innerHTML = '<li>Kein Heuriger geöffnet.</li>';
    } else {
        let bounds = [];
        openToday.forEach(event => {
            const li = document.createElement('li');
            li.innerHTML = `<strong><a href="${event.url}" target="_blank">${event.title}</a></strong> 
(ab ${new Date(event.start).toLocaleTimeString('de-AT', {hour: '2-digit', minute:'2-digit', hour12: false})} Uhr)`;
            ul.appendChild(li);

            // Add marker if possible
            if (
                event.extendedProps &&
                typeof event.extendedProps.lat === "number" &&
                typeof event.extendedProps.lng === "number"
            ) {
                // console.log(event.extendedProps.lat, event.extendedProps.lng);
                const latlng = [event.extendedProps.lat, event.extendedProps.lng];
                addMarker(
                    latlng[0],
                    latlng[1],
                    `<strong>${event.title}</strong><br>
                    <a href="${event.url}" target="_blank" style="color:#457c43;text-decoration:underline;">Website</a> &middot; 
                    <a href="${event.extendedProps.mapLink}" target="_blank" style="color:#457c43;text-decoration:underline;">Google Maps</a>`
                );
                bounds.push(latlng);
            } else if (event.extendedProps && event.extendedProps.mapLink) {
                const latlng = extractLatLng(event.extendedProps.mapLink);
                if (latlng) {
                    addMarker(latlng[0], latlng[1], `<strong>${event.title}</strong><br><a href="${event.url}" target="_blank">Website</a>`);
                    bounds.push(latlng);
                }
            }
        });
        // Zoom to bounds if markers exist
        if (bounds.length > 0) {
            map.fitBounds(bounds, {padding: [30, 30]});
        } else {
            map.setView([48.3006, 16.3906], 13);
        }
    }
}

Promise.all(jsonFiles.map(file => fetch(file).then(r => r.json())))
    .then(results => {
        allEvents = results.flat();
        renderList();
    });

prevBtn.addEventListener('click', () => {
    if (getISO(currentDate) > getISO(today)) {
        currentDate.setDate(currentDate.getDate() - 1);
        renderList();
    }
});

nextBtn.addEventListener('click', () => {
    if (getISO(currentDate) < getISO(maxDate)) {
        currentDate.setDate(currentDate.getDate() + 1);
        renderList();
    }
});

let map = L.map('map').setView([48.3006, 16.3906], 13); // Center on Stammersdorf

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

let markerGroup = L.layerGroup().addTo(map);

function clearMarkers() {
    markerGroup.clearLayers();
}

function addMarker(lat, lng, popupHtml) {
    L.marker([lat, lng], { icon: greenIcon }).bindPopup(popupHtml).addTo(markerGroup);
}

// Helper to extract lat/lng from Google Maps short links
function extractLatLng(mapLink) {
    // Supports links like https://maps.app.goo.gl/...
    // and direct Google Maps links with @lat,lng
    try {
        if (mapLink.includes('@')) {
            // e.g. https://www.google.com/maps/place/.../@48.3006,16.3906,17z/
            const match = mapLink.match(/@([0-9\.\-]+),([0-9\.\-]+)/);
            if (match) return [parseFloat(match[1]), parseFloat(match[2])];
        }
        // fallback: try to resolve short links server-side or ignore
    } catch (e) {}
    return null;
}

const greenIcon = L.icon({
    iconUrl: 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="48" viewBox="0 0 32 48"><path fill="%23457c43" stroke="white" stroke-width="2" d="M16 2C8.268 2 2 8.268 2 16c0 10.493 12.03 28.01 12.53 28.74a2 2 0 0 0 3.94 0C17.97 44.01 30 26.493 30 16c0-7.732-6.268-14-14-14zm0 20a6 6 0 1 1 0-12 6 6 0 0 1 0 12z"/></svg>',
    iconSize:     [32, 48],
    iconAnchor:   [16, 47],
    popupAnchor:  [0, -40]
});
</script>



        <!-- GoatCounter -->
        <script data-goatcounter="https://auschecktis.goatcounter.com/count"
            async
            src="//gc.zgo.at/count.js"></script>


    </body>
</html>
